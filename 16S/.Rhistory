annotations = "***", textsize = 6,
y_position = 0.85, tip_length = 0,
map_signif_level=TRUE, vjust = 0.5) +
geom_signif(comparisons = list(c("A", "C")),
annotations = "***", textsize = 6,
y_position =0.895, tip_length = 0,
map_signif_level=TRUE, vjust = 0.5) +
theme(legend.position="none",
axis.text.x=element_text(size = 14),
axis.text.y = element_text(size = 14),
strip.text.y = element_text(size=18, face = 'bold'),
plot.title = element_text(size = 20,  face = 'bold'),
axis.title.y =element_text(size=18,face="bold"),
axis.title.x = element_blank(),
plot.background = element_blank(),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank())+
stat_summary(fun="median",geom="point", size=13, color="red", shape=95)
dis.plant.bc
permod.its.bc # there is marginal differences in dispersion between groups
mod.bc
hsd.its.bc=TukeyHSD(mod.its.bc) #which groups differ in relation to their variances
hsd.its.bc
plot(hsd.its.bc)
hsd.group.its.bc=hsd.its.bc$group
df.hsd.group.its.bc=as.data.frame(hsd.group.its.bc)
df.hsd.group.its.bc=rownames_to_column(df.hsd.group.its.bc, var = "Comparison")
names(df.hsd.group.its.bc)[names(df.hsd.group.its.bc) == "p adj"] <- "P.adj"
df.hsd.group.its.bc
dis.summ.plant.its.bc <- its.map.bc.mod %>% group_by(Plant) %>% summarize(max.dis=max(Dispersion))
hsd.letter.its.bc = cldList(P.adj ~ Comparison,
data = df.hsd.group.its.bc,
threshold = 0.05)
names(hsd.letter.its.bc)[names(hsd.letter.its.bc) == "Group"] <- "Plant"
new.dis.sum.its.bc <- left_join(hsd.letter.its.bc,dis.summ.plant.its.bc,by='Plant')
new.dis.sum.its.bc
new.dis.sum.its.bc
plot(hsd.its.bc)
hsd.its.bc
permod.its.bc # there is marginal differences in dispersion between groups
disperplot.its.bc <- ggplot(its.map.bc.mod, aes(x=Plant, y=Dispersion, fill=Plant))+
geom_violin(alpha=0.4, position = position_dodge(width = .75),size=0.5, trim = F) +
scale_fill_viridis(discrete = T)+
geom_point(shape = 21,size=2, position = position_jitterdodge(),alpha=1)+
theme_bw()+
expand_limits(x = 0, y = 0)+
labs(title= "(d)", y="Dispersion")+
geom_signif(comparisons = list(c("B", "C")),
annotations = "*", textsize = 6,
y_position = 0.85, tip_length = 0,
map_signif_level=TRUE, vjust = 0.5) +
theme(legend.position="none",
axis.text.x=element_text(size = 14),
axis.text.y = element_text(size = 14),
strip.text.y = element_text(size=18, face = 'bold'),
plot.title = element_text(size = 20, face = 'bold'),
#axis.title.x =element_text(size=18,face="bold"),
axis.title.y=element_blank(),
axis.title.x=element_blank(),
plot.background = element_blank(),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank())+
stat_summary(fun="median",geom="point", size=13, color="red", shape=95)
disperplot.its.bc
permod.its.bc # there is marginal differences in dispersion between groups
set.seed  (1)
hsd.its.bc=TukeyHSD(mod.its.bc) #which groups differ in relation to their variances
hsd.its.bc
disperplot.its.bc <- ggplot(its.map.bc.mod, aes(x=Plant, y=Dispersion, fill=Plant))+
geom_violin(alpha=0.4, position = position_dodge(width = .75),size=0.5, trim = F) +
scale_fill_viridis(discrete = T)+
geom_point(shape = 21,size=2, position = position_jitterdodge(),alpha=1)+
theme_bw()+
expand_limits(x = 0, y = 0)+
labs(title= "(d)", y="Dispersion")+
geom_signif(comparisons = list(c("B", "C")),
annotations = "*", textsize = 6,
y_position = 0.85, tip_length = 0,
map_signif_level=TRUE, vjust = 0.5) +
theme(legend.position="none",
axis.text.x=element_text(size = 14),
axis.text.y = element_text(size = 14),
strip.text.y = element_text(size=18, face = 'bold'),
plot.title = element_text(size = 20, face = 'bold'),
#axis.title.x =element_text(size=18,face="bold"),
axis.title.y=element_blank(),
axis.title.x=element_blank(),
plot.background = element_blank(),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank())+
stat_summary(fun="median",geom="point", size=13, color="red", shape=95)
disperplot.its.bc
set.seed(1)
disperplot.its.bc <- ggplot(its.map.bc.mod, aes(x=Plant, y=Dispersion, fill=Plant))+
geom_violin(alpha=0.4, position = position_dodge(width = .75),size=0.5, trim = F) +
scale_fill_viridis(discrete = T)+
geom_point(shape = 21,size=2, position = position_jitterdodge(),alpha=1)+
theme_bw()+
expand_limits(x = 0, y = 0)+
labs(title= "(d)", y="Dispersion")+
geom_signif(comparisons = list(c("B", "C")),
annotations = "*", textsize = 6,
y_position = 0.85, tip_length = 0,
map_signif_level=TRUE, vjust = 0.5) +
theme(legend.position="none",
axis.text.x=element_text(size = 14),
axis.text.y = element_text(size = 14),
strip.text.y = element_text(size=18, face = 'bold'),
plot.title = element_text(size = 20, face = 'bold'),
#axis.title.x =element_text(size=18,face="bold"),
axis.title.y=element_blank(),
axis.title.x=element_blank(),
plot.background = element_blank(),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank())+
stat_summary(fun="median",geom="point", size=13, color="red", shape=95)
disperplot.its.bc
disperplot.its.bc
new.dis.sum.its.bc
hsd.its.bc
set.seed(1)
permod.bc # there is significant differences in dispersion between groups
hsd.bc=TukeyHSD(mod.bc) #which groups differ in relation to their variances
hsd.bc
#plot betadisper among plant
set.seed(1)
dis.plant.bc <- ggplot(map.pcoa.bc.mod, aes(x=Plant, y=Dispersion, fill=Plant))+
geom_violin(alpha=0.4, position = position_dodge(width = .75),size=0.5, trim = F) +
#scale_fill_manual(labels = c("A", "B", "C"),values=c("#CC6677", "#DDCC77","#117733"))+
scale_fill_viridis(discrete = T)+
#geom_jitter(position = position_jitter(width = 0.1, height = 0, seed=13), alpha=0.5)+
geom_point(shape = 21,size=2, position = position_jitterdodge(),alpha=1)+
theme_bw()+
expand_limits(x = 0, y = 0)+
labs(y="Dispersion", title = "(c)")+
#geom_text(data=new.dis.sum, aes(x=Plant,y=0.05+max.dis,label=Letter), vjust=0)+
geom_signif(comparisons = list(c("A", "B")),
annotations = "***", textsize = 6,
y_position = 0.85, tip_length = 0,
map_signif_level=TRUE, vjust = 0.5) +
geom_signif(comparisons = list(c("A", "C")),
annotations = "***", textsize = 6,
y_position =0.895, tip_length = 0,
map_signif_level=TRUE, vjust = 0.5) +
theme(legend.position="none",
axis.text.x=element_text(size = 14),
axis.text.y = element_text(size = 14),
strip.text.y = element_text(size=18, face = 'bold'),
plot.title = element_text(size = 20,  face = 'bold'),
axis.title.y =element_text(size=18,face="bold"),
axis.title.x = element_blank(),
plot.background = element_blank(),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank())+
stat_summary(fun="median",geom="point", size=13, color="red", shape=95)
dis.plant.bc
pod.pcoa2.bc
pod.pcoa.its2.bc
dis.plant.bc
its.map
setwd('/Users/arifinabintarti/Documents/Bean_seed_variability_Bintarti_2020/Figures/NewFigures')
library(patchwork)
PCoA.Beta.bc <- (pod.pcoa2.bc | pod.pcoa.its2.bc ) / (dis.plant.bc | disperplot.its.bc)
PCoA.Beta.bc
PCoA.Beta2.bc <- patchwork::patchworkGrob(PCoA.Beta.bc)
PCoA.Beta3.bc <- gridExtra::grid.arrange(PCoA.Beta2.bc, bottom =textGrob("Plant", gp=gpar(fontsize=18,fontface='bold')))
ggsave("Fig.S2.eps",
PCoA.Beta3.bc, device=cairo_ps,
width = 10, height = 9,
units= "in", fallback_resolution = 600)
mod
set.seed(13)
groups.plant <- factor(c(rep("A",12),rep("B",24), rep("C",11)))
otu_dist <- vegdist(t(bacnorm_PA), binary = TRUE, method = "jaccard") #Sorensen
mod <- betadisper(otu_dist, groups.plant)
mod
plot(mod)
mod$distances
dispersion <- as.data.frame(mod$distance)
names(dispersion)[names(dispersion) == "mod$distance"] <- "Dispersion"
#add dispersion index
dispersion <- rownames_to_column(dispersion, "Sample.id")
#join dispersion index to the map
bean.map <- merge(bean.map, dispersion, by="Sample.id", all = T)
# dissimilarity indices for community ecologist to make a distance structure (Jaccard distance between samples)
bacnorm_PA <- 1*(otu.norm>0)
bacnorm_PA
otu_dist <- vegdist(t(bacnorm_PA), binary = TRUE, method = "jaccard") #Sorensen
# CMD/classical multidimensional scaling (MDS) of a data matrix. Also known as principal coordinates analysis
otu_pcoa <- cmdscale(otu_dist, eig=T)
# scores of PC1 and PC2
ax1.scores=otu_pcoa$points[,1]
ax2.scores=otu_pcoa$points[,2]
# calculate percent variance explained, then add to plot
ax1 <- otu_pcoa$eig[1]/sum(otu_pcoa$eig)
ax2 <- otu_pcoa$eig[2]/sum(otu_pcoa$eig)
map <- cbind(bean.map,ax1.scores,ax2.scores)
# simple plot
pcoa_plot <- plot(ax1.scores, ax2.scores, xlab=paste("PCoA1: ",round(ax1,3)*100,"% var. explained", sep=""), ylab=paste("PCoA2: ",round(ax2,3)*100,"% var. explained", sep=""))
set.seed(13)
pod.pcoa <- ggplot(data = map, aes(x=ax1.scores, y=ax2.scores))+
theme_bw()+
geom_point(data = map, aes(x = ax1.scores, y = ax2.scores, col=factor(Plant)),size=5, alpha =0.7)+
#scale_color_manual(labels = c("A1","A2", "A3","B1","B2","B3","B4","B5","B6","C5","C6","C7"),values=c("#440154FF", "#482677FF","#3F4788FF","#238A8DFF","#1F968BFF","#20A386FF","#29AF7FFF","#3CBB75FF","#56C667FF","#B8DE29FF","#DCE318FF","#FDE725FF"))+
scale_color_viridis(discrete = T) +
scale_x_continuous(name=paste("PCoA1:\n",round(ax1,3)*100,"% var. explained", sep=""))+
scale_y_continuous(name=paste("PCoA2:\n",round(ax2,3)*100,"% var. explained", sep=""))+
#coord_fixed() +
labs(colour = "Plant",  title = "(a) Bacteria/archaea")+
theme(legend.position="none",
plot.background = element_blank(),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
plot.title = element_text(size = 20, face="bold"),
#plot.subtitle = element_text(size = 20, face = 'bold'),
axis.text=element_text(size=14),
axis.title=element_text(size=15,face="bold"),
legend.text=element_text(size=12),
legend.title = element_text(size = 12),
legend.spacing.x = unit(0.05, 'cm'))
set.seed(13)
pod.pcoa2 <- pod.pcoa + geom_text_repel(aes(label = Pod),size = 3, max.overlaps = Inf)
pod.pcoa2
pod.pcoa2
pod.pcoa2
# SET THE WORKING DIRECTORY
setwd('/Users/arifinabintarti/Documents/GitHub/Bean_seed_variability_Bintarti_2021/16S')
wd <- print(getwd())
otu <- read.table('OTU_table_tax_filt.txt', sep='\t', header=T, row.names = 1)
otu
tax <- otu[,'taxonomy']
str(tax)
#write.csv(tax, file = "taxonomy.csv")
dim(otu)
otu <- otu[,-51]
dim(otu) # otu= 273, otu table still has Mock, NC, and PC in the sample
sort(rowSums(otu, na.rm = FALSE, dims = 1), decreasing = F)
#read taxonomy
taxonomy = read.csv("taxonomy.edit.csv", header=T)
rownames(taxonomy) <- rownames(otu)
dim(taxonomy)
#read the metadata
map <- read.csv("bean.var.map.csv")
#select only biological sample from otu table
otu.bac <- otu[,1:47] #unselect Mock, NC, and PC from the otu table
dim(otu.bac)
sort(rowSums(otu.bac, na.rm = FALSE, dims = 1), decreasing = F)
# remove OTUs that do not present in sample
otu.bac1=otu.bac[which(rowSums(otu.bac) > 0),]
dim(otu.bac1) # otu= 229, otu table before normalization using metagenomeSeq package and before decontamination
sort(rowSums(otu.bac1, na.rm = FALSE, dims = 1), decreasing = F)
# merge otu.bac1 with taxonomy to have match taxonomy table
head(otu.bac1)
otu.bac1 <- rownames_to_column(otu.bac1,var = "OTU.ID")
taxonomy <- rownames_to_column(taxonomy,var = "OTU.ID")
otu.bac1.tax <- merge(otu.bac1, taxonomy, by="OTU.ID")
dim(otu.bac1.tax)
#  separate  the otu table
#otu table
otu.bac.plantfil <- data.frame(otu.bac1.tax[,c(1:48)])
head(otu.bac.plantfil)
otu.bac.plantfil <- column_to_rownames(otu.bac.plantfil,var="OTU.ID")
sum(otu.bac.plantfil)
#otu table of the negative control
otu.NC <- otu[,"NC",drop=FALSE]#only negative control
otu.NC
#merge otu.NC to otu bac and put otu.NC as the first column
head(otu.NC)
otu.NC <- rownames_to_column(otu.NC, var = "OTU.ID")
head(otu.bac1)
#otu.bac1 <- rownames_to_column(otu.bac1, var = "OTU.ID")
otu.NC.bac <- merge(otu.NC, otu.bac1, by="OTU.ID")
dim(otu.NC.bac)
#decontamination
otu.decon <- decon(data = otu.NC.bac, numb.blanks = 1, numb.ind = 47, taxa = F)
otu.decon$OTUs.removed # remove 18 OTUs
otu.tab <- as.data.frame(otu.decon$decon.table)
dim(otu.tab) #there are 211 otus and 47 samples
head(otu.tab)
#remove NC from the otu.dec.table
otu.tab <- otu.tab[,c(1,3:49)]
#merge otu.dec.table with taxonomy to have match taxonomy table
head(taxonomy)
#taxonomy <- rownames_to_column(taxonomy, var = "OTU.ID")
otu.tab.tax <- merge(otu.tab, taxonomy, by = "OTU.ID")
otu.tab.tax
#separate the otu table and taxonomy table
#otu table
decon.otu <- data.frame(otu.tab.tax[,c(1:48)])
dim(decon.otu) #211 otus, 47samples
tax <- data.frame(otu.tab.tax[,c(1,49:55)], row.names = 1)
dim(tax) #211 otus, 7columns/levels
head(decon.otu)
decon.otu <- column_to_rownames(decon.otu, var = "OTU.ID")
sort(colSums(decon.otu, na.rm = FALSE, dims = 1), decreasing = F)
sort(rowSums(decon.otu, na.rm = FALSE, dims = 1), decreasing = F)
#loading count data (otu)
decon.otu
#loading metadata
map <- read.csv("bean.var.map.csv")
head(map)
dim(map)
map <- column_to_rownames(map, var="Sample.id")
phenotypeData <- AnnotatedDataFrame(map)
phenotypeData
#loading taxonomy
head(tax)
OTUdata <- AnnotatedDataFrame(tax)
OTUdata
#Creating a MRexperiment object
model <- newMRexperiment(decon.otu, phenoData = phenotypeData, featureData = OTUdata)
model
sort(rowSums(MRcounts(model), na.rm = FALSE, dims = 1), decreasing = T)
# 1. calculate the proper percentile by which to normalize counts
p <- cumNormStatFast(model, pFlag = T)
p
# 2. To calculate the scaling factors we simply run cumNorm
#cumNorm=Calculates each columnâ€™s quantile and calculates the sum up to and including that quantile.
bac.norm <- cumNorm(model, p = p)
bac.norm
# 3. Exporting normalized count matrix
otu.norm <- MRcounts(bac.norm, norm = TRUE, log = F)
otu.norm <- as.data.frame(otu.norm)
head(sort(colSums(otu.norm, na.rm = FALSE, dims = 1), decreasing = FALSE))
head(sort(rowSums(otu.norm, na.rm = FALSE, dims = 1), decreasing = FALSE))
head(otu.norm)
otu.norm <- rownames_to_column(otu.norm, var="OTU.ID")
#write.table(otu.norm, "otu_norm.txt", sep = "\t", quote = F, row.names = F)
dim(otu.norm) #there are 211 otus and 47 samples
# dissimilarity indices for community ecologist to make a distance structure (Jaccard distance between samples)
bacnorm_PA <- 1*(otu.norm>0)
bacnorm_PA
otu_dist <- vegdist(t(bacnorm_PA), binary = TRUE, method = "jaccard") #Sorensen
# CMD/classical multidimensional scaling (MDS) of a data matrix. Also known as principal coordinates analysis
otu_pcoa <- cmdscale(otu_dist, eig=T)
# scores of PC1 and PC2
ax1.scores=otu_pcoa$points[,1]
ax2.scores=otu_pcoa$points[,2]
# calculate percent variance explained, then add to plot
ax1 <- otu_pcoa$eig[1]/sum(otu_pcoa$eig)
ax2 <- otu_pcoa$eig[2]/sum(otu_pcoa$eig)
map <- cbind(bean.map,ax1.scores,ax2.scores)
# dissimilarity indices for community ecologist to make a distance structure (Jaccard distance between samples)
bacnorm_PA <- 1*(otu.norm>0)
bacnorm_PA
#write.table(otu.norm, "otu_norm.txt", sep = "\t", quote = F, row.names = F)
dim(otu.norm) #there are 211 otus and 47 samples
head(otu.norm)
library(phyloseq)
decon.otu # decontaminated non-normalized OTU table
# make phyloseq otu table and taxonomy
otu1.phyl = otu_table(decon.otu, taxa_are_rows = TRUE)
tax.phyl = tax_table(as.matrix(tax))
# make phyloseq map
bean.map <- map
head(bean.map)
bean.map <- rownames_to_column(bean.map, var = "Sample.id")
bean.map$Plant <- as.factor(bean.map$Plant)
bean.map$Sample.id <- as.factor(bean.map$Sample.id)
head(bean.map)
rownames(bean.map) <- bean.map$Sample.id
map.phyl <- sample_data(bean.map)
phyl.obj1 <- merge_phyloseq(otu1.phyl,tax.phyl,map.phyl)
phyl.obj1
#set seed
set.seed(42)
p.bac <- p.rare +
#facet_wrap(~Plant, labeller = label_both)+
theme_bw()+
scale_color_manual(values = Palette)+
scale_size_manual(values = 60)+
labs(title = "(a) Bacteria/archaea")+
theme( strip.text.x = element_text(size=14, face='bold'),
axis.text.x=element_text(size = 14),
axis.text.y = element_text(size = 14),
strip.text.y = element_text(size=18, face = 'bold'),
plot.title = element_text(size =20 ,face='bold'),
axis.title.y = element_text(size=15,face="bold"),
axis.title.x = element_blank(),
legend.position = "none",
#legend.title = element_text(size=15),
plot.background = element_blank(),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank())+
ylab("Number of OTUs")
plot(p.bac)
# load normalized otu table
otu.norm
head(otu.norm)
otu.norm <- column_to_rownames(otu.norm, var = "OTU.ID")
# bacterial taxonomy
head(tax)
#tax <- column_to_rownames(tax, var = "OTU.ID")
rownames(tax) <- rownames(otu.norm)
# make phyloseq otu table and taxonomy
otu.phyl = otu_table(otu.norm, taxa_are_rows = TRUE)
tax.phyl = tax_table(as.matrix(tax))
# make phyloseq map
rownames(bean.map) <- bean.map$Sample.id
map.phyl <- sample_data(bean.map)
phyl.obj <- merge_phyloseq(otu.phyl,tax.phyl,map.phyl)
phyl.obj
# this converts taxa counts in each sample to a percentage
phyloTemp2 <-  transform_sample_counts(phyl.obj, function(x) x/sum(x))
clusterData2 <-  psmelt(phyloTemp2)
# calculating mean relative abundance per plant
relabund.perplant2= clusterData2 %>%
group_by(Plant, Pod, OTU) %>%
summarise(ra=mean(Abundance)) %>%
arrange(desc(ra),.by_group = TRUE) %>%
mutate(rank = row_number(-ra))
relabund.perplant2$Plant <- as.factor(relabund.perplant2$Plant)
relabund.perplant2$Pod <- as.factor(relabund.perplant2$Pod)
setwd('/Users/arifinabintarti/Documents/GitHub/Bean_seed_variability_Bintarti_2021/16S')
wd <- print(getwd())
# calculate richness
head(otu.norm)
#otu.norm <- column_to_rownames(otu.norm, var="OTU.ID")
s <- specnumber(otu.norm, MARGIN = 2) # richness
rich <- as.data.frame(s)
bean.map <- map
dim(bean.map)
bean.map$Richness <- s
bean.map
#add Faith's PD index
pd.index <- read.table('PD.txt', sep='\t', header=T, row.names = 1)
pd.index <- rownames_to_column(pd.index, "Sample.id")
#join Faith's PD index to the map
bean.map <- rownames_to_column(bean.map, var = "Sample.id")
bean.map <- merge(bean.map, pd.index, by="Sample.id", all = T)
bean.map$Plant <- as.factor(bean.map$Plant)
bean.map$Pod <- as.factor(bean.map$Pod)
set.seed(13)
# Fit random intercept model
model = lme(Richness ~ Plant, random = ~ 1|Pod, data=bean.map, method="REML")
summary(model)
aov.mod = anova.lme(model,
type="marginal",
adjustSigma = FALSE)
aov.mod
anova(model, type='marginal') #  for the unbalanced data
# Fit random intercept and slope model
model2 <- lme(Richness ~ Plant, random = ~ Plant | Pod, data = bean.map, method = "REML")
AIC(model, model2)
anova(model, model2)
# dissimilarity indices for community ecologist to make a distance structure (Jaccard distance between samples)
bacnorm_PA <- 1*(otu.norm>0)
bacnorm_PA
otu_dist <- vegdist(t(bacnorm_PA), binary = TRUE, method = "jaccard") #Sorensen
# CMD/classical multidimensional scaling (MDS) of a data matrix. Also known as principal coordinates analysis
otu_pcoa <- cmdscale(otu_dist, eig=T)
# scores of PC1 and PC2
ax1.scores=otu_pcoa$points[,1]
ax2.scores=otu_pcoa$points[,2]
# calculate percent variance explained, then add to plot
ax1 <- otu_pcoa$eig[1]/sum(otu_pcoa$eig)
ax2 <- otu_pcoa$eig[2]/sum(otu_pcoa$eig)
map <- cbind(bean.map,ax1.scores,ax2.scores)
# simple plot
pcoa_plot <- plot(ax1.scores, ax2.scores, xlab=paste("PCoA1: ",round(ax1,3)*100,"% var. explained", sep=""), ylab=paste("PCoA2: ",round(ax2,3)*100,"% var. explained", sep=""))
set.seed(13)
pod.pcoa <- ggplot(data = map, aes(x=ax1.scores, y=ax2.scores))+
theme_bw()+
geom_point(data = map, aes(x = ax1.scores, y = ax2.scores, col=factor(Plant)),size=5, alpha =0.7)+
#scale_color_manual(labels = c("A1","A2", "A3","B1","B2","B3","B4","B5","B6","C5","C6","C7"),values=c("#440154FF", "#482677FF","#3F4788FF","#238A8DFF","#1F968BFF","#20A386FF","#29AF7FFF","#3CBB75FF","#56C667FF","#B8DE29FF","#DCE318FF","#FDE725FF"))+
scale_color_viridis(discrete = T) +
scale_x_continuous(name=paste("PCoA1:\n",round(ax1,3)*100,"% var. explained", sep=""))+
scale_y_continuous(name=paste("PCoA2:\n",round(ax2,3)*100,"% var. explained", sep=""))+
#coord_fixed() +
labs(colour = "Plant",  title = "(a) Bacteria/archaea")+
theme(legend.position="none",
plot.background = element_blank(),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
plot.title = element_text(size = 20, face="bold"),
#plot.subtitle = element_text(size = 20, face = 'bold'),
axis.text=element_text(size=14),
axis.title=element_text(size=15,face="bold"),
legend.text=element_text(size=12),
legend.title = element_text(size = 12),
legend.spacing.x = unit(0.05, 'cm'))
set.seed(13)
pod.pcoa2 <- pod.pcoa + geom_text_repel(aes(label = Pod),size = 3, max.overlaps = Inf)
pod.pcoa2
set.seed(13)
otu_dist
set.seed(13)
map$Plant <- as.factor(map$Plant)
map$Pod <- as.factor(map$Pod)
nested.npmanova(unname(otu_dist) ~ Plant + Pod,
data = map,
method = "jac",
permutations = 999)
set.seed(13)
groups.plant <- factor(c(rep("A",12),rep("B",24), rep("C",11)))
otu_dist <- vegdist(t(bacnorm_PA), binary = TRUE, method = "jaccard") #Sorensen
mod <- betadisper(otu_dist, groups.plant)
mod
plot(mod)
mod$distances
dispersion <- as.data.frame(mod$distance)
names(dispersion)[names(dispersion) == "mod$distance"] <- "Dispersion"
#add dispersion index
dispersion <- rownames_to_column(dispersion, "Sample.id")
#join dispersion index to the map
bean.map <- merge(bean.map, dispersion, by="Sample.id", all = T)
set.seed(13)
#permutation-based test for multivariate homogeneity of group dispersion (variances)
permod <- permutest(mod, permutations = 999, pairwise = T)
permod # there is significant differences in dispersion between groups
hsd=TukeyHSD(mod) #which groups differ in relation to their variances
hsd
